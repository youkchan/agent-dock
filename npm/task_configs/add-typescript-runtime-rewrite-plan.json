{
  "meta": {
    "auto_target_path_tasks": [],
    "persona_resolution": {
      "global_disable_personas": [],
      "tasks_with_persona_policy": [
        "1.1",
        "1.2",
        "1.3",
        "1.4",
        "1.5",
        "1.6",
        "2.1",
        "2.10",
        "2.11",
        "2.2",
        "2.3",
        "2.4",
        "2.5",
        "2.6",
        "2.7",
        "2.8",
        "2.9"
      ]
    },
    "source_change_id": "add-typescript-runtime-rewrite-plan",
    "verification_items": [
      {
        "checked": false,
        "line": 107,
        "text": "3.1 ドキュメント互換を実行検証する"
      },
      {
        "checked": false,
        "line": 112,
        "text": "3.2 CLI 互換を実行検証する"
      },
      {
        "checked": false,
        "line": 117,
        "text": "3.3 wrapper 互換を実行検証する"
      },
      {
        "checked": false,
        "line": 122,
        "text": "3.4 state.json 互換を実行検証する"
      },
      {
        "checked": false,
        "line": 127,
        "text": "3.5 compile 互換を実行検証する"
      },
      {
        "checked": false,
        "line": 132,
        "text": "3.6 ファイルロックを実行検証する（テストコード）"
      }
    ]
  },
  "persona_defaults": {
    "phase_order": [
      "implement",
      "review",
      "spec_check",
      "test"
    ],
    "phase_policies": {
      "implement": {
        "active_personas": [
          "implementer"
        ],
        "executor_personas": [
          "implementer"
        ],
        "state_transition_personas": [
          "implementer"
        ]
      },
      "review": {
        "active_personas": [
          "code-reviewer"
        ],
        "executor_personas": [
          "code-reviewer"
        ],
        "state_transition_personas": [
          "code-reviewer"
        ]
      },
      "spec_check": {
        "active_personas": [
          "spec-checker"
        ],
        "executor_personas": [
          "spec-checker"
        ],
        "state_transition_personas": [
          "spec-checker"
        ]
      },
      "test": {
        "active_personas": [
          "test-owner"
        ],
        "executor_personas": [
          "test-owner"
        ],
        "state_transition_personas": [
          "test-owner"
        ]
      }
    }
  },
  "personas": [
    {
      "can_block": false,
      "enabled": true,
      "execution": {
        "command_ref": "default",
        "enabled": true,
        "sandbox": "workspace-write",
        "timeout_sec": 900
      },
      "focus": "実装を前進させる",
      "id": "implementer",
      "role": "implementer"
    },
    {
      "can_block": false,
      "enabled": true,
      "execution": {
        "command_ref": "default",
        "enabled": true,
        "sandbox": "workspace-write",
        "timeout_sec": 900
      },
      "focus": "品質と回帰リスクを確認する",
      "id": "code-reviewer",
      "role": "reviewer"
    },
    {
      "can_block": false,
      "enabled": true,
      "execution": {
        "command_ref": "default",
        "enabled": true,
        "sandbox": "workspace-write",
        "timeout_sec": 900
      },
      "focus": "仕様逸脱を防ぐ",
      "id": "spec-checker",
      "role": "spec_guard"
    },
    {
      "can_block": false,
      "enabled": true,
      "execution": {
        "command_ref": "default",
        "enabled": true,
        "sandbox": "workspace-write",
        "timeout_sec": 900
      },
      "focus": "検証の十分性を担保する",
      "id": "test-owner",
      "role": "test_guard"
    }
  ],
  "tasks": [
    {
      "depends_on": [],
      "description": "`docs/ts-migration-contract.md` に CLI/state/compile の互換契約（I/O 要件・禁止変更点）を明記する",
      "id": "1.1",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "team_orchestrator/*.py",
        "tests/*.py",
        "README.md",
        "docs/ts-migration-contract.md"
      ],
      "title": "現行 Python 契約を固定する"
    },
    {
      "depends_on": [
        "1.1"
      ],
      "description": "`docs/ts-architecture-blueprint.md` に domain/application/infrastructure/cli の責務境界を定義する",
      "id": "1.2",
      "persona_policy": {
        "phase_order": [
          "implement",
          "spec_check"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "spec_check": {
            "active_personas": [
              "spec-checker"
            ],
            "executor_personas": [
              "spec-checker"
            ],
            "state_transition_personas": [
              "spec-checker"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "docs/ts-architecture-blueprint.md",
        "openspec/changes/add-typescript-runtime-rewrite-plan/*"
      ],
      "title": "TypeScript の目標構成を定義する"
    },
    {
      "depends_on": [
        "1.1"
      ],
      "description": "`docs/ts-parity-gate.md` に golden fixture 比較対象、正規化ルール、acceptance gate を定義する",
      "id": "1.3",
      "persona_policy": {
        "phase_order": [
          "review",
          "test"
        ],
        "phase_overrides": {
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "docs/ts-parity-gate.md",
        "tests/parity/*"
      ],
      "title": "パリティ検証方式を定義する"
    },
    {
      "depends_on": [
        "1.2",
        "1.3"
      ],
      "description": "`docs/ts-cutover-runbook.md` に runner 切替順序、fallback 条件、完了判定を定義する",
      "id": "1.4",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review",
          "test"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "README.md",
        "docs/ts-cutover-runbook.md"
      ],
      "title": "段階移行・切替・ロールバック手順を定義する"
    },
    {
      "depends_on": [
        "1.1"
      ],
      "description": "wrapper 実行経路、I/O契約、既定解決順、埋め込み `python3` から Deno helper への置換方針を明記する",
      "id": "1.5",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "docs/ts-wrapper-contract.md",
        "openspec/changes/add-typescript-runtime-rewrite-plan/*"
      ],
      "title": "wrapper 契約を文書化する"
    },
    {
      "depends_on": [
        "1.1"
      ],
      "description": "env 一覧、デフォルト値、型、優先順位、互換可否を明記する",
      "id": "1.6",
      "persona_policy": {
        "phase_order": [
          "spec_check",
          "test"
        ],
        "phase_overrides": {
          "spec_check": {
            "active_personas": [
              "spec-checker"
            ],
            "executor_personas": [
              "spec-checker"
            ],
            "state_transition_personas": [
              "spec-checker"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "docs/ts-env-compat-matrix.md",
        "openspec/changes/add-typescript-runtime-rewrite-plan/*"
      ],
      "title": "環境変数互換マトリクスを文書化する"
    },
    {
      "depends_on": [
        "1.1",
        "1.2"
      ],
      "description": "`src/domain`, `src/application`, `src/infrastructure`, `src/cli` の最小構成を作成する",
      "id": "2.1",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "src/**",
        "deno.json",
        "deno.lock"
      ],
      "title": "TypeScript プロジェクト骨格を作成する"
    },
    {
      "depends_on": [
        "2.9"
      ],
      "description": "`scripts/update_runner.sh` が再 install ではなく再生成（build）主体の更新フローを提供する",
      "id": "2.10",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "scripts/update_runner.sh",
        "docs/ts-cutover-runbook.md"
      ],
      "title": "runner 更新スクリプトを build 主体へ整理する"
    },
    {
      "depends_on": [
        "2.9",
        "2.10"
      ],
      "description": "初回 `npm link`、日常ループ（`build_npm.ts --watch`）、`./node_modules/.bin/agent-dock` 実行手順を明記する",
      "id": "2.11",
      "persona_policy": {
        "phase_order": [
          "review",
          "spec_check",
          "test"
        ],
        "phase_overrides": {
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          },
          "spec_check": {
            "active_personas": [
              "spec-checker"
            ],
            "executor_personas": [
              "spec-checker"
            ],
            "state_transition_personas": [
              "spec-checker"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "README.md"
      ],
      "title": "開発運用手順を README に追記する"
    },
    {
      "depends_on": [
        "2.1"
      ],
      "description": "Task/Persona/Policy の型・正規化ロジックを Python と等価に実装する",
      "id": "2.2",
      "persona_policy": {
        "phase_order": [
          "implement",
          "spec_check"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "spec_check": {
            "active_personas": [
              "spec-checker"
            ],
            "executor_personas": [
              "spec-checker"
            ],
            "state_transition_personas": [
              "spec-checker"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "src/domain/**",
        "src/infrastructure/persona/**"
      ],
      "title": "domain / persona / policy 系を移植する"
    },
    {
      "depends_on": [
        "2.2"
      ],
      "description": "`compile-openspec` / `print-openspec-template` が Python と同等に動作する",
      "id": "2.3",
      "persona_policy": {
        "phase_order": [
          "implement",
          "spec_check",
          "test"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "spec_check": {
            "active_personas": [
              "spec-checker"
            ],
            "executor_personas": [
              "spec-checker"
            ],
            "state_transition_personas": [
              "spec-checker"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "src/infrastructure/openspec/**",
        "src/cli/**"
      ],
      "title": "openspec compiler/template を移植する"
    },
    {
      "depends_on": [
        "2.2"
      ],
      "description": "state 遷移・claim/handoff/approval・persona handoff を Python と等価に実装する",
      "id": "2.4",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review",
          "test"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "src/infrastructure/state/**",
        "src/application/orchestrator/**",
        "src/domain/**"
      ],
      "title": "state store と orchestrator を同一マイルストーンで移植する"
    },
    {
      "depends_on": [
        "2.4"
      ],
      "description": "`subprocess adapter -> codex_wrapper.sh -> codex exec` 経路を維持して run 実行できる",
      "id": "2.5",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "src/infrastructure/provider/**",
        "src/infrastructure/adapter/**",
        "src/cli/**"
      ],
      "title": "provider / adapter / wrapper 連携を移植する"
    },
    {
      "depends_on": [
        "2.3",
        "2.4",
        "2.5",
        "2.8"
      ],
      "description": "compile/state/主要 CLI フローの Python vs TS 比較テストを実装する",
      "id": "2.6",
      "persona_policy": {
        "phase_order": [
          "spec_check",
          "test"
        ],
        "phase_overrides": {
          "spec_check": {
            "active_personas": [
              "spec-checker"
            ],
            "executor_personas": [
              "spec-checker"
            ],
            "state_transition_personas": [
              "spec-checker"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "tests/parity/**",
        "docs/ts-parity-gate.md"
      ],
      "title": "parity テスト基盤を実装する"
    },
    {
      "depends_on": [
        "2.6"
      ],
      "description": "切替条件を満たした場合のみ TS 実装へ切替し、失敗時は Python へ戻せる状態にする",
      "id": "2.7",
      "persona_policy": {
        "phase_order": [
          "review",
          "test"
        ],
        "phase_overrides": {
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "README.md",
        "docs/ts-cutover-runbook.md"
      ],
      "title": "切替判定とロールバック手順を実行可能化する"
    },
    {
      "depends_on": [
        "2.5"
      ],
      "description": "prompt 生成 / `.env` スナップショット検証 / 4行結果抽出を Deno helper で実行し、外部挙動を維持する",
      "id": "2.8",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review",
          "test"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "codex_wrapper.sh",
        "src/infrastructure/wrapper/**",
        "docs/ts-wrapper-contract.md"
      ],
      "title": "codex_wrapper の埋め込み Python を Deno helper に置換する"
    },
    {
      "depends_on": [
        "2.1"
      ],
      "description": "`scripts/build_npm.ts` で npm 配布物が再生成でき、`npm link` 運用に利用できる",
      "id": "2.9",
      "persona_policy": {
        "phase_order": [
          "implement",
          "review",
          "test"
        ],
        "phase_overrides": {
          "implement": {
            "active_personas": [
              "implementer"
            ],
            "executor_personas": [
              "implementer"
            ],
            "state_transition_personas": [
              "implementer"
            ]
          },
          "review": {
            "active_personas": [
              "code-reviewer"
            ],
            "executor_personas": [
              "code-reviewer"
            ],
            "state_transition_personas": [
              "code-reviewer"
            ]
          },
          "test": {
            "active_personas": [
              "test-owner"
            ],
            "executor_personas": [
              "test-owner"
            ],
            "state_transition_personas": [
              "test-owner"
            ]
          }
        }
      },
      "requires_plan": false,
      "target_paths": [
        "scripts/build_npm.ts",
        "npm/**"
      ],
      "title": "npm 生成物ビルドスクリプトを実装する"
    }
  ],
  "teammates": [
    "teammate-a",
    "teammate-b"
  ]
}