## コンテキスト
`run` は毎回 `bootstrap_tasks(..., replace=True)` を実行するため、`state_dir` に進捗が残っていても復元されない。
この挙動は初回実行には安全だが、失敗後の再試行で作業効率が下がる。

## 目標
- 明示オプションでのみ途中再開を有効化し、既定挙動は壊さない。
- task 定義の食い違いがある状態で誤再開しない。
- 運用者が起動直後に「再開か新規か」を判別できる。
- 長時間タスクでも途中経過を失わないよう、実行中ログを逐次保存する。

## 非目標
- 自動再開（オプションなしでの暗黙再開）
- state マイグレーション
- 部分的な task 定義マージ
- Teammate コマンドの標準出力全文を無制限保存すること

## 決定事項
### 1) 再開スイッチ
- `--resume` 指定時のみ再開モードを有効化する。
- `--resume` 未指定時は従来どおり再初期化する。

### 2) 再開判定
- `state_dir` に task が存在しない場合は、`--resume` でも初期投入して開始する。
- task が存在する場合は既存 state を保持し、`replace=False` 相当で実行する。

### 3) 整合性チェック
- 再開時は入力 task_config と state 内 task の整合性を検証する。
- 最低限、`id` / `requires_plan` / `depends_on` / `target_paths` の不一致を検出して失敗する。
- 不一致時は安全側で停止し、差分要約をエラー出力する。

### 4) 可観測性
- 起動時ログに `run_mode=new-run|resume-run` を出力する。

### 5) 実行途中ログの永続化
- Teammate 実行中に得られる途中出力をタスク単位で state に追記保存する。
- 保存先は `state.json` の task ごとの `progress_log`（時系列配列）とし、最低限 `timestamp` / `source` / `text` を持つ。
- resume 時は既存 `progress_log` を保持し、タスク再実行時は新規エントリを追記する。
- 無制限増加を避けるため、タスクごとに保持件数上限を設け、古いものからローテーションする。

## リスクと緩和
- リスク: 古い state を誤再利用する
  - 緩和: `--resume` 明示必須 + 整合性チェック
- リスク: ユーザーが再開中と気づかない
  - 緩和: 起動モードログを必須化
- リスク: 途中ログの保存量増大で state が肥大化する
  - 緩和: タスク単位の保持件数上限とローテーション
